<div class="loading-state" *ngIf="isLoading"
    style="text-align: center; padding: 4rem; font-size: 1.5rem; color: #636e72;">
    â³ Se Ã®ncarcÄƒ detaliile reÈ›etei...
</div>

<div class="error-state" *ngIf="error" style="text-align: center; padding: 4rem; color: #d63031;">
    <h2>ğŸ˜¢ {{ error }}</h2>
    <button (click)="goBack()" style="padding: 0.8rem 1.5rem; margin-top: 1rem; cursor: pointer;">Ãnapoi la
        listÄƒ</button>
</div>

<div class="detail-container" *ngIf="recipe && !isLoading">
    <div class="header-actions">
        <button class="back-btn" (click)="goBack()">â† Ãnapoi</button>

        <div class="app-menu-container">
            <button class="menu-btn" (click)="toggleMenu()">OpÈ›iuni</button>
            <div class="app-menu" *ngIf="showMenu">
                <button (click)="toggleFavorite()">
                    {{ recipe.isFavorite ? 'ğŸ’” EliminÄƒ de la Favorite' : 'â¤ï¸ AdaugÄƒ la Favorite' }}
                </button>
                <button (click)="addToShoppingList()">ğŸ›’ AdaugÄƒ la ListÄƒ</button>
                <button (click)="openMealPlanModal()">ğŸ“… AdaugÄƒ Ã®n Planificator</button>
                <button (click)="printRecipe()">ğŸ–¨ ImprimÄƒ</button>
            </div>
        </div>
    </div>

    <div class="recipe-header">
        <img [src]="recipe.imageUrl" [alt]="recipe.title" class="hero-image">
        <div class="header-content">
            <h1>{{ recipe.title }}</h1>
            <p class="description">{{ recipe.description }}</p>
            <div class="meta-info">
                <span>â± Timp de preparare: {{ recipe.cookingTime }} minute</span>
                <span *ngIf="recipe.isFavorite" class="favorite-badge">â¤ï¸ Favorit</span>
            </div>
        </div>
    </div>

    <div class="recipe-body">
        <div class="section ingredients">
            <h2>Ingrediente</h2>
            <ul>
                <li *ngFor="let ingredient of recipe.ingredients">{{ ingredient }}</li>
            </ul>
        </div>

        <div class="section steps">
            <h2>Mod de preparare</h2>
            <ol>
                <li *ngFor="let step of recipe.steps">{{ step }}</li>
            </ol>
        </div>
    </div>

    <!-- Nutrition Section -->
    <div class="nutrition-section" *ngIf="nutritionData">
        <h2>Valori NutriÈ›ionale (Estimat / porÈ›ie)</h2>
        <div class="nutrition-card">
            <div class="chart-container">
                <div class="pie-chart"
                    [style.background]="'conic-gradient(#ff6b6b 0% 35%, #54a0ff 35% 65%, #ffd32a 65% 100%)'"></div>
                <div class="total-cals">
                    <strong>{{ nutritionData.calories | number:'1.0-0' }}</strong>
                    <span>kcal</span>
                </div>
            </div>
            <div class="nutrition-legend">
                <div class="legend-item">
                    <span class="dot" style="background: #ff6b6b"></span>
                    <span class="label">Proteine</span>
                    <span class="value">{{ nutritionData.protein }}g</span>
                </div>
                <div class="legend-item">
                    <span class="dot" style="background: #54a0ff"></span>
                    <span class="label">CarbohidraÈ›i</span>
                    <span class="value">{{ nutritionData.carbs }}g</span>
                </div>
                <div class="legend-item">
                    <span class="dot" style="background: #ffd32a"></span>
                    <span class="label">GrÄƒsimi</span>
                    <span class="value">{{ nutritionData.fat }}g</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Reviews Section -->
    <div class="reviews-section">
        <h2>Recenzii È™i Rating</h2>

        <div class="rating-summary">
            <div class="average-rating">
                <span class="star">â˜…</span>
                <span class="score">{{ averageRating | number:'1.1-1' }}</span>
                <span class="count">({{ recipe.ratings?.length || 0 }} voturi)</span>
            </div>
        </div>

        <div class="add-review">
            <h3>AdaugÄƒ o recenzie</h3>
            <div class="rating-input">
                <label>Nota ta:</label>
                <select [(ngModel)]="newReviewRating">
                    <option [value]="5">5 â˜…â˜…â˜…â˜…â˜…</option>
                    <option [value]="4">4 â˜…â˜…â˜…â˜…</option>
                    <option [value]="3">3 â˜…â˜…â˜…</option>
                    <option [value]="2">2 â˜…â˜…</option>
                    <option [value]="1">1 â˜…</option>
                </select>
            </div>
            <textarea [(ngModel)]="newReviewText" placeholder="Spune-ne pÄƒrerea ta despre aceastÄƒ reÈ›etÄƒ..."
                rows="3"></textarea>
            <button class="submit-btn" (click)="submitReview()" [disabled]="!newReviewText.trim()">PosteazÄƒ
                Recenzia</button>
        </div>

        <div class="comments-list">
            <div class="comment" *ngFor="let comment of recipe.comments">
                <div class="comment-header">
                    <strong>{{ comment.user }}</strong>
                    <span class="comment-date">{{ comment.date | date:'shortDate' }}</span>
                    <span class="comment-stars">{{ 'â˜…'.repeat(comment.rating) }}</span>
                </div>
                <p>{{ comment.text }}</p>
            </div>
            <p *ngIf="!recipe.comments?.length" class="no-reviews">Fii primul care lasÄƒ o recenzie!</p>
        </div>
    </div>

    <!-- Meal Plan Modal -->
    <div class="modal-overlay" *ngIf="showMealPlanModal" (click)="closeMealPlanModal()">
        <div class="modal-content" (click)="$event.stopPropagation()">
            <h3>AdaugÄƒ Ã®n Planificator</h3>
            <p>Alege ziua È™i momentul zilei pentru <strong>{{ recipe?.title }}</strong></p>

            <div class="form-group">
                <label>Ziua:</label>
                <select [(ngModel)]="selectedDay">
                    <option *ngFor="let day of days" [value]="day">{{ day }}</option>
                </select>
            </div>

            <div class="form-group">
                <label>Masa:</label>
                <select [(ngModel)]="selectedType">
                    <option *ngFor="let type of mealTypes" [value]="type">{{ type }}</option>
                </select>
            </div>

            <div class="modal-actions">
                <button class="cancel-btn" (click)="closeMealPlanModal()">AnuleazÄƒ</button>
                <button class="confirm-btn" (click)="addToMealPlan()">SalveazÄƒ</button>
            </div>
        </div>
    </div>
</div>